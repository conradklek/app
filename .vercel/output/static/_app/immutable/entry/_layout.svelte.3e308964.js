var q=Object.defineProperty;var G=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var g=(e,t,n)=>(G(e,typeof t!="symbol"?t+"":t,n),n);import{S as J,i as X,s as K,e as T,b as Q,g as k,d as P,f as Z,h as ee,C as te,o as re,D as w,E as ne,F as se,G as ae,H as ie,v as oe}from"../chunks/index.a741111b.js";import{w as m,l as ce}from"../chunks/localforage.68c88524.js";var C=Symbol("Comlink.proxy"),le=Symbol("Comlink.endpoint"),S=Symbol("Comlink.releaseProxy"),A=Symbol("Comlink.thrown"),j=e=>typeof e=="object"&&e!==null||typeof e=="function",ue={canHandle:e=>j(e)&&Boolean(e[C]),serialize(e){const{port1:t,port2:n}=new MessageChannel,r=e[C];return N(e,t,typeof r=="object"?r:void 0),[n,[n]]},deserialize(e){return e.start(),B(e)}},fe={canHandle:e=>j(e)&&A in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},z=new Map([["proxy",ue],["throw",fe]]);function N(e,t=self,n){t.addEventListener("message",function r(s){if(!s||!s.data)return;const{id:a,type:i,path:o}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(h);let c;try{const l=(n==null?void 0:n.spec)==null;let p=e,f=e,y=n==null?void 0:n.spec,F=y;for(const d of o){if(p=f,F=y,l){f=f[d];continue}if(typeof y=="object"&&y.hasOwnProperty(d))f=f[d],y=y[d];else{f=void 0,y=void 0;break}}switch(i){case 0:c=f;break;case 1:{c=!1;const d=(n==null?void 0:n.set)!==!1,b=l||F==="primitive"||y==="primitive";b||(p=void 0),(d||!b)&&(p[o.slice(-1)[0]]=h(s.data.value),c=!0)}break;case 2:l||y==="function"||(f=void 0),c=f.apply(p,u);break;case 3:{l||(f=void 0);const d=new f(...u);c=R(d)}break;case 4:{const{port1:d,port2:b}=new MessageChannel;N(e,b,n),c=M(d,[d])}break;case 5:c=void 0;break}}catch(l){c={value:l,[A]:0}}Promise.resolve(c).catch(l=>({value:l,[A]:0})).then(l=>{const[p,f]=I(l);t.postMessage(Object.assign(Object.assign({},p),{id:a}),f),i===5&&(t.removeEventListener("message",r),H(t))})}),t.start&&t.start()}function de(e){return e.constructor.name==="MessagePort"}function H(e){de(e)&&e.close()}function B(e,t){return L(e,[],t)}function v(e){if(e)throw new Error("Proxy has been released and is not useable")}function L(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(a,i){if(v(r),i===S)return()=>_(e,{type:5,path:t.map(o=>o.toString())}).then(()=>{H(e),r=!0});if(i==="then"){if(t.length===0)return{then:()=>s};const o=_(e,{type:0,path:t.map(u=>u.toString())}).then(h);return o.then.bind(o)}return L(e,[...t,i])},set(a,i,o){v(r);const[u,c]=I(o);return _(e,{type:1,path:[...t,i].map(l=>l.toString()),value:u},c).then(h)},apply(a,i,o){v(r);const u=t[t.length-1];if(u===le)return _(e,{type:4}).then(h);if(u==="bind")return L(e,t.slice(0,-1));const[c,l]=x(o);return _(e,{type:2,path:t.map(p=>p.toString()),argumentList:c},l).then(h)},construct(a,i){v(r);const[o,u]=x(i);return _(e,{type:3,path:t.map(c=>c.toString()),argumentList:o},u).then(h)}});return s}function me(e){return Array.prototype.concat.apply([],e)}function x(e){const t=e.map(I);return[t.map(n=>n[0]),me(t.map(n=>n[1]))]}var V=new WeakMap;function M(e,t){return V.set(e,t),e}function R(e,t){return Object.assign(e,{[C]:t??!0})}function I(e){for(const[t,n]of z)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:3,name:t,value:r},s]}return[{type:0,value:e},V.get(e)||[]]}function h(e){switch(e.type){case 3:return z.get(e.name).deserialize(e.value);case 0:return e.value}}function _(e,t,n){return new Promise(r=>{const s=ye();e.addEventListener("message",function a(i){!i.data||!i.data.id||i.data.id!==s||(e.removeEventListener("message",a),r(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)})}function ye(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function $(e){const t={d:{}};for(const n of Object.keys(e)){const r=e[n];if("file"in r){const a=r.file.contents,i=typeof a=="string"?a:we(a),o=typeof a=="string"?{}:{b:!0};t.d[n]={f:{c:i,...o}};continue}const s=$(r.directory);t.d[n]=s}return t}function we(e){let t="";for(const n of e)t+=String.fromCharCode(n);return t}var pe="https://stackblitz.com/headless",E=null,O=!1,U=!1,he=new TextDecoder,_e=new TextEncoder,Y=class{constructor(e,t,n){g(this,"fs");this._endpoint=e,this._iframe=n,this.fs=new ke(t)}async spawn(e,t,n){let r=[];Array.isArray(t)?r=t:n=t;let s=new ReadableStream,a;(n==null?void 0:n.output)!==!1&&(s=new ReadableStream({start(u){a=c=>u.enqueue(c)}}));const i=Ce(Pe(a)),o=await this._endpoint.run({command:e,args:r,env:n==null?void 0:n.env,terminal:n==null?void 0:n.terminal},void 0,void 0,i);return new Ee(o,s)}on(e,t){let n=!1,r=()=>{};const s=(...a)=>{n||t(...a)};return this._endpoint.on(e,R(s)).then(a=>{r=a,n&&r()}),()=>{n=!0,r()}}mount(e,t){const n=_e.encode(JSON.stringify($(e)));return this._endpoint.loadFiles(M(n,[n.buffer]),{mountPoints:t==null?void 0:t.mountPoint})}teardown(){if(U)throw new Error("WebContainer already torn down");U=!0,this.fs._teardown(),this._endpoint.teardown(),this._endpoint[S](),this._iframe.remove()}static async boot(){for(;E;)await E;if(O)throw new Error("WebContainer already booted");const e=Se();E=e.catch(()=>{});try{const t=await e;return O=!0,t}finally{E=null}}},be=1,ge=2,ve=class{constructor(e,t){this.name=e,this._type=t}isFile(){return this._type===be}isDirectory(){return this._type===ge}},Ee=class{constructor(e,t){g(this,"input");this._process=e,this.output=t,this.input=new WritableStream({write:n=>{this._process.write(n).catch(()=>{})}})}get exit(){return this._process.onExit}kill(){this._process.kill()}resize(e){this._process.resize(e)}},ke=class{constructor(e){g(this,"_fs");this._fs=e}rm(...e){return this._fs.rm(...e)}async readFile(e,t){return await this._fs.readFile(e,t)}async writeFile(e,t,n){if(t instanceof Uint8Array){const r=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);t=M(new Uint8Array(r),[r])}await this._fs.writeFile(e,t,n)}async readdir(e,t){const n=await this._fs.readdir(e,t);return Le(n)||Me(n)?n:n.map(s=>new ve(s.name,s["Symbol(type)"]))}async mkdir(e,t){return await this._fs.mkdir(e,t)}_teardown(){this._fs[S]()}};async function Se(){const{iframe:e,endpointPromise:t}=Ae(),n=await t,r=await n.build({host:window.location.host,version:"1.0.2"}),s=await r.fs();return n[S](),new Y(r,s,e)}function Pe(e){if(e!=null)return t=>{t instanceof Uint8Array&&e(he.decode(t))}}function Ce(e){if(e!=null)return R(e)}function Ae(){const e=document.createElement("iframe");e.style.display="none",e.setAttribute("allow","cross-origin-isolated");const t=D();e.src=D().toString();const{origin:n}=t,r=new Promise(s=>{const a=i=>{if(i.origin!==n)return;const{data:o}=i;if(o.type==="init"){s(B(i.ports[0]));return}if(o.type==="warning"){console[o.level].call(console,o.message);return}};window.addEventListener("message",a)});return document.body.insertBefore(e,null),{iframe:e,endpointPromise:r}}function Le(e){return typeof e[0]=="string"}function Me(e){return e[0]instanceof Uint8Array}function D(){return new URL(window.WEBCONTAINER_API_IFRAME_URL??pe)}function W(e){let t;const n=e[2].default,r=ne(n,e,e[1],null);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,a){r&&r.m(s,a),t=!0},p(s,a){r&&r.p&&(!t||a&2)&&se(r,n,s,s[1],t?ie(n,s[1],a,null):ae(s[1]),null)},i(s){t||(k(r,s),t=!0)},o(s){P(r,s),t=!1},d(s){r&&r.d(s)}}}function Re(e){let t,n,r=e[0]&&W(e);return{c(){r&&r.c(),t=T()},l(s){r&&r.l(s),t=T()},m(s,a){r&&r.m(s,a),Q(s,t,a),n=!0},p(s,[a]){s[0]?r?(r.p(s,a),a&1&&k(r,1)):(r=W(s),r.c(),k(r,1),r.m(t.parentNode,t)):r&&(oe(),P(r,1,1,()=>{r=null}),Z())},i(s){n||(k(r),n=!0)},o(s){P(r),n=!1},d(s){r&&r.d(s),s&&ee(t)}}}function Ie(e,t,n){let r;te(e,m,i=>n(0,r=i));let{$$slots:s={},$$scope:a}=t;return re(async()=>{if(crossOriginIsolated)try{w(m,r=await Y.boot(),r),r.on("server-ready",(i,o)=>{w(m,r.host=o,r),w(m,r.port=i,r),w(m,r.pwd=`~/${new URL(r.host).host.split(".")[0].split("--")[0]}/`,r)}),await r.mount(await ce.getItem("indexedDB")||{}),w(m,r.terminal=await r.spawn("jsh"),r),w(m,r.terminal.stream="",r),r.terminal.output.pipeTo(new WritableStream({write(i){w(m,r.terminal.stream+=i,r)}})),w(m,r.terminal.input=r.terminal.input.getWriter(),r),m.set(r)}catch{}else w(m,r=!1,r)}),e.$$set=i=>{"$$scope"in i&&n(1,a=i.$$scope)},[r,a,s]}class Oe extends J{constructor(t){super(),X(this,t,Ie,Re,K,{})}}export{Oe as default};
